<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgentVerse Console</title>
  <style>
    body { margin: 0; background: #020617; color: #e2e8f0; font-family: Inter, system-ui, sans-serif; }
    .grid { display:grid; grid-template-columns: repeat(4, minmax(140px,1fr)); gap: 12px; }
    .card { background: #0f172a; border: 1px solid #334155; border-radius: 10px; padding: 12px; }
    .wrap { max-width: 980px; margin: 20px auto; padding: 0 12px; }
    button,input,textarea { background:#0b1220; color:#e2e8f0; border:1px solid #334155; border-radius:8px; padding:8px; }
    label { display:block; font-size:12px; color:#94a3b8; margin-top:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>AgentVerse Console</h1>
    <p>Internal admin dashboard for world metrics, profiles, and task forcing.</p>

    <div class="grid" id="metrics"></div>

    <div class="card" style="margin-top:14px">
      <h3>Update Agent Personality</h3>
      <label>Access Token</label>
      <input id="token" style="width:100%" placeholder="Bearer token without prefix" />
      <label>Agent ID (UUID)</label>
      <input id="agentId" style="width:100%" />
      <label>Personality JSON</label>
      <textarea id="personality" style="width:100%;height:120px">{"style":"strategic","sociability":0.8}</textarea>
      <label>Capabilities (comma separated)</label>
      <input id="caps" style="width:100%" value="navigation,conversation,planning" />
      <button id="save">Save Profile</button>
      <pre id="out"></pre>
    </div>
  </div>

  <script type="module">
    const API = '/agentverse-api';

    async function loadMetrics() {
      const t = document.getElementById('token').value.trim();
      if (!t) return;
      const r = await fetch(`${API}/admin/metrics`, { headers: { Authorization: `Bearer ${t}` } });
      const data = await r.json();
      const m = data.metrics || {};
      document.getElementById('metrics').innerHTML = Object.entries(m)
        .map(([k,v]) => `<div class="card"><div style="font-size:12px;color:#94a3b8">${k}</div><div style="font-size:24px;font-weight:700">${v}</div></div>`)
        .join('');
    }

    document.getElementById('save').onclick = async () => {
      const token = document.getElementById('token').value.trim();
      const agentId = document.getElementById('agentId').value.trim();
      const personality = JSON.parse(document.getElementById('personality').value || '{}');
      const capabilities = document.getElementById('caps').value.split(',').map(v => v.trim()).filter(Boolean);
      const r = await fetch(`${API}/admin/profiles/${agentId}`, {
        method: 'POST',
        headers: { 'Content-Type':'application/json', Authorization: `Bearer ${token}` },
        body: JSON.stringify({ personality, capabilities })
      });
      document.getElementById('out').textContent = JSON.stringify(await r.json(), null, 2);
      await loadMetrics();
    };

    document.getElementById('token').addEventListener('change', loadMetrics);
  </script>
</body>
</html>
